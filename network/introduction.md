---
title: 计算机网络基本概念
---

# 计算机网络基本概念

## 物理层

**通信方式**：

1. 单工：单向通信
2. 半双工：双向交替通信
3. 全双工：双向同时通信

## 链路层

链路层被称为2层（L2）

**信道复用**：

1. 频分复用：所有主机在**相同**时间占据**不同**的频率带宽资源
2. 时分复用（TDM）：所有主机的**不同时间**占据**相同**的频率带宽资源。每个TDM帧按固定顺序包含不同用户要发送的数据，即使用户没有数据，也要把位置留出来。
3. 统计时分复用（STDM）：对TDM的改进，不固定用户在STDM帧中的位置，只要有用户数据，就集中成一个STDM帧然后发送。
4. 波分复用：光的频分复用。光的频率一般用波长表示
5. 码分复用：为每个用户分配m比特码片，不同的用户的码片正交（作为向量计算内积，0作-1）。用户发送比特1时就发送该码片，否则就发送反码。接收方用用户的码片对发送的数据做内积，得到1就是收到比特1，得到-1就是收到比特0。
6. CSMA/CD协议：多点接入（许多主机连接到一条总线上），载波监听（每个主机不停地监听信道，在发送前，如果听到信道正在使用，就必须等待），碰撞检测（如果在发送数据时听到其他主机发送了数据，就说明发生了碰撞；当发生碰撞时，停止发送，等待一段时间后再重新发送）

**以太网**：

1. 以太网是**星型拓扑结构**的**局域网**
2. 最初使用**集线器**作中心，所有主机连接到集线器上。集线器把收到的所有信息都广播给其他所有主机
3. 现在改用**交换机**，根据MAC地址对信息作转发。一个交换机有多个交换口，一个交换口收到的信息，会被转发到另一个交换口。从MAC地址到交换口的映射称为**交换表**。交换机具有**自学习能力**，不需要管理员手动配置。对于交换表中没有的MAC地址，交换机会将数据广播到除发送方外的所有交换口。每在一个交换口收到信息，交换机会在交换表中把给定MAC地址和这个交换口记录下来。
4. 交换机可以互相连接，把小局域网组成大局域网。

**虚拟局域网（VLAN）**：

1. 一个局域网里，任何一个主机广播消息，所有其他主机都能收到。

   如果一个局域网过大，局域网里的广播消息就会又多又杂。

2. VLAN的作用是，在只用一个交换机的情况下，把一个局域网分成多个。

3. VLAN的实现原理是设置交换机，让它把**交换口**分别标记一个**VLAN号**。只在具有相同VLAN号的交换口之间转发消息。

4. 如果有多个交换机，比如两个交换机A和B，各有两个VLAN，号码为1和2，分别记为A1和A2，B1和B2。如果把这两个交换机连起来，使得相同VLAN号的两个VLAN连接成一个VLAN，即A1和B1拼接起来，A2和B2拼接起来。那么，用来连接这两个交换机的交换口，应该设置什么VLAN号呢？

5. 因为两个交换机之间需要转发VLAN1和VLAN2的数据，用来连接交换机的两个交换口被设置为**干线（Trunk）**口，也就是能**转发多个VLAN数据**的交换口。

6. 在干线上发送数据时，需要标记数据到底是VLAN1的还是VLAN2的。在**干线**上的数据传输使用的是扩展的**以太网帧802.1Q**，在标准的以太网帧的头部增加了一个四字节的VLAN字段。

## 网络层

**IP**: 网络层被称为三层（L3）。L3网络只有一种，就是IP网络。

**IP配套协议**：与IP协议配套使用的几个协议，有ARP，ICMP和IGMP。

**路由器**：路由器把不同的局域网连接起来。一个路由器有多个网卡（网络接口），分别连接在不同的局域网中。路由器根据IP地址选择往哪个方向转发，这个过程被称为路由。

> 普通的主机也需要进行路由，只不过局域网里的主机的路由一般会很简单，无外乎就是：发到本局域网里，发给网关（一般由路由器担任）。

**ARP协议**：同一个局域网内发消息时，如果只知道对方的IP地址，不知道MAC地址，可以使用ARP协议通过广播询问的方式查找局域网里哪个主机具有给定的IP地址。主机一般会把查询的结果做缓存。

> 比如：一台主机（或路由器）在查路由表时，发现目标IP地址匹配到了自己的某个网卡所在的一个局域网，但自己却不认得这个IP，这时就需要用到ARP协议
>
> ARP协议是和IP平级的协议，但只利用了L2网络通信，实现和IP路由没有任何关系，只是功能和IP有关

**ICMP协议**：ICMP和ARP一样，是用来协助IP的。但和ARP不同，ICMP需要跨局域网工作，所以ICMP的数据包需要IP帮忙传输，但ICMP仍然属于L3，不是更高层协议。

**路由自治系统**：路由器可以通过路由自治协议来动态调整路由表，免去人手工配置路由表的麻烦。路由自治协议通过路由器之间交换路由数据，使得每个路由器能够得到全局的网络拓扑信息。

1. 互联网由多个路由自治系统（AS）组成，每个AS可以选择自己内部的路由自治协议。
2. AS内部的路由自治协议包括RIP和OSPF。
3. AS之间的路由通过外部网关协议（BGP）实现。每个AS需要选择自己的（一个或多个）BGP发言人，只有这些发言人和其他AS连接。

## 传输层

**UDP**: 无拥塞控制、流量控制，无连接

**TCP**: 有连接，可靠性，拥塞控制，流量控制

## 应用层

**DNS**: 使用TCP和UDP。大多数情况下使用UDP，只有返回超过512字节时使用TCP，或是主域名服务器向辅助域名服务器发送变化的数据时

**FTP**: 控制连接+数据连接。主动模式和被动模式。

**DHCP**: 自动配置、子网掩码、网关IP。Discover, Offer, Request, Ack

**电子邮件协议**:

1. 发送协议SMTP：只能发送ASCII码。互联网邮件扩充（MIME）增加了邮件的主体结构，支持了二进制文件。
2. 读取协议POP3：只要用户读取了邮件，就把邮件从服务器删除
3. 读取协议IMAP：允许用户随时随地访问服务器上的邮件

| 应用             | 应用层协议 | 端口号  | 运输层协议 | 备注                        |
| ---------------- | ---------- | ------- | ---------- | --------------------------- |
| 域名解析         | DNS        | 53      | UDP/TCP    | 长度超过 512 字节时使用 TCP |
| 动态主机配置协议 | DHCP       | 67/68   | UDP        |                             |
| 简单网络管理协议 | SNMP       | 161/162 | UDP        |                             |
| 文件传送协议     | FTP        | 20/21   | TCP        | 控制连接 21，数据连接 20    |
| 远程终端协议     | TELNET     | 23      | TCP        |                             |
| 超文本传送协议   | HTTP       | 80      | TCP        |                             |
| 简单邮件传送协议 | SMTP       | 25      | TCP        |                             |
| 邮件读取协议     | POP3       | 110     | TCP        |                             |
| 网际报文存取协议 | IMAP       | 143     | TCP        |                             |

## IO模型

应用程序在进行网络通信时，在调用系统函数进行读写和操作结束之间会有一定时差，怎样处理这个时差就是IO模型的主题。

应用程序等待的时间分为两段。第一段，网卡把数据发送过来，存储到内核中，这被称为数据准备。第二段，操作系统把数据从内核拷贝到用户进程。

**阻塞式IO**：应用进程被阻塞，直到数据从内核拷贝到进程。第一段和第二段都在阻塞中度过

**非阻塞式IO**：应用进程调用IO操作后，内核返回一个错误码，应用程序需要轮询（polling）以获知IO是否完成。第一段和第二段都在轮询中度过

**IO复用**：等待多个套接字中的一个变为可读，这个过程阻塞，直到一个套接字可读时返回，然后调用recvfrom从内核复制数据到进程。这种模式下，第一段和第二段都在阻塞中度过，只不过中间返回了一次。但这就支持了更高级的功能，即多个IO同时监听，谁先准备好数据，就先拷贝谁。

1. select: 阻塞，直到有描述符的事件到达或者等待事件超过timeout，只能监听1024个描述符
2. poll: 和select功能相同，改用链表实现，提供了更多事件类型
3. epoll: 比select和poll更加灵活

**信号驱动IO**：应用程序调用IO操作后，内核立刻返回。等到数据到达后，内核向应用程序发出一个SIGIO信号。应用程序收到信号后调用recvfrom从内核复制数据到内存。第一段没有阻塞，但也不需要轮询，第二段阻塞。

**异步IO**：和信号驱动IO类似，只不过是在数据复制完成后发送信号。只有异步IO在从内核拷贝数据到进程时是非阻塞的。其他四种模型都是同步模型，即在拷贝数据时阻塞。第一段和第二段都没有阻塞，且不需要轮询。

